<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Semanal - GelaClashRoyale</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        :root {
            --primary-blue: #0a1a3a;
            --secondary-blue: #1a3a7a;
            --accent-blue: #2a5ac8;
            --light-blue: #4a8aff;
            --gold: #ffd700;
            --light-gold: #ffed4e;
            --white: #ffffff;
            --off-white: #f5f7ff;
            --dark: #050a1a;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark) 100%);
            color: var(--white);
            min-height: 100vh;
            padding-bottom: 40px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            text-align: center;
            padding: 30px 0 20px;
            position: relative;
        }
        
        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--light-blue), var(--gold));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(74, 138, 255, 0.3);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--light-blue);
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(10, 26, 58, 0.8);
            border-radius: 12px;
            padding: 15px 25px;
            margin: 0 auto 30px;
            max-width: 800px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gold);
            font-family: 'Orbitron', sans-serif;
        }
        
        .status-label {
            font-size: 0.9rem;
            color: var(--light-blue);
            margin-top: 5px;
        }
        
        /* Ranking Table */
        .ranking-section {
            background: rgba(10, 26, 58, 0.7);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--light-gold);
        }
        
        .section-title i {
            margin-right: 15px;
            color: var(--gold);
        }
        
        .ranking-table {
            width: 100%;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        thead {
            background: rgba(26, 58, 122, 0.8);
        }
        
        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 700;
            color: var(--light-gold);
            font-size: 1.1rem;
            border-bottom: 2px solid var(--gold);
        }
        
        th:first-child {
            border-radius: 10px 0 0 0;
        }
        
        th:last-child {
            border-radius: 0 10px 0 0;
        }
        
        td {
            padding: 20px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        tr {
            transition: all 0.3s ease;
        }
        
        tbody tr:hover {
            background: rgba(42, 90, 200, 0.2);
        }
        
        /* Position styling */
        .position {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            text-align: center;
            width: 70px;
        }
        
        .pos-1 .position {
            color: var(--gold);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.7);
        }
        
        .pos-2 .position {
            color: #c0c0c0;
            text-shadow: 0 0 5px rgba(192, 192, 192, 0.7);
        }
        
        .pos-3 .position {
            color: #cd7f32;
            text-shadow: 0 0 5px rgba(205, 127, 50, 0.7);
        }
        
        /* Player info */
        .player-info {
            display: flex;
            align-items: center;
        }
        
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--light-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            margin-right: 15px;
            border: 2px solid var(--gold);
        }
        
        .player-name {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .player-name span {
            margin-left: 8px;
        }
        
        .crown {
            color: var(--gold);
        }
        
        /* Points */
        .points {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--light-gold);
        }
        
        /* Status indicators */
        .trend-up {
            color: var(--success);
        }
        
        .trend-down {
            color: var(--danger);
        }
        
        .trend-neutral {
            color: var(--light-blue);
        }
        
        /* Podium styling */
        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin: 30px 0 40px;
            gap: 20px;
        }
        
        .podium-item {
            background: linear-gradient(to bottom, rgba(255, 215, 0, 0.9), rgba(255, 215, 0, 0.2));
            border-radius: 12px 12px 0 0;
            padding: 20px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .podium-2 {
            height: 120px;
            background: linear-gradient(to bottom, rgba(192, 192, 192, 0.9), rgba(192, 192, 192, 0.2));
        }
        
        .podium-1 {
            height: 160px;
            order: 2;
        }
        
        .podium-3 {
            height: 100px;
            background: linear-gradient(to bottom, rgba(205, 127, 50, 0.9), rgba(205, 127, 50, 0.2));
            order: 3;
        }
        
        .podium-player {
            font-weight: 700;
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .podium-points {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            margin-top: 5px;
            color: var(--dark);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--light-blue);
        }
        
        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--gold);
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--light-blue);
            font-size: 0.9rem;
        }
        
        .firebase-status {
            display: inline-flex;
            align-items: center;
            background: rgba(10, 26, 58, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            margin-top: 15px;
        }
        
        .firebase-status.connected {
            color: var(--success);
        }
        
        .firebase-status.disconnected {
            color: var(--danger);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .connected .status-dot {
            background-color: var(--success);
            box-shadow: 0 0 8px var(--success);
        }
        
        .disconnected .status-dot {
            background-color: var(--danger);
            box-shadow: 0 0 8px var(--danger);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .logo {
                font-size: 2.2rem;
            }
            
            .podium {
                flex-wrap: wrap;
            }
            
            .podium-item {
                min-width: 120px;
            }
        }
        
        @media (max-width: 768px) {
            .logo {
                font-size: 1.8rem;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .podium {
                gap: 10px;
            }
            
            .podium-item {
                min-width: 100px;
                padding: 15px 10px;
            }
            
            .ranking-section {
                padding: 15px;
            }
        }
        
        @media (max-width: 576px) {
            .logo {
                font-size: 1.6rem;
            }
            
            .player-avatar {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .player-name {
                font-size: 1rem;
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            .container {
                padding: 0 15px;
            }
        }
        
        /* Animation for top player */
        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--gold); }
            50% { box-shadow: 0 0 20px var(--gold); }
            100% { box-shadow: 0 0 5px var(--gold); }
        }
        
        .pos-1 {
            animation: glow 3s infinite;
            background: linear-gradient(to right, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="logo">GELACLASH ROYALE</h1>
            <p class="subtitle">RANKING SEMANAL - TOP JOGADORES</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value" id="total-players">0</div>
                    <div class="status-label">JOGADORES</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="top-score">0</div>
                    <div class="status-label">RECORDE</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="avg-points">0</div>
                    <div class="status-label">MÃ‰DIA DE PONTOS</div>
                </div>
            </div>
        </header>
        
        <div class="podium" id="podium-container">
            <!-- Podium will be generated by JavaScript -->
        </div>
        
        <section class="ranking-section">
            <h2 class="section-title"><i class="fas fa-trophy"></i> CLASSIFICAÃ‡ÃƒO COMPLETA</h2>
            
            <div class="ranking-table">
                <div class="loading" id="loading">
                    <i class="fas fa-spinner fa-spin"></i><br>
                    Carregando ranking...
                </div>
                
                <table id="ranking-table" style="display: none;">
                    <thead>
                        <tr>
                            <th style="width: 80px;">POSIÃ‡ÃƒO</th>
                            <th>JOGADOR</th>
                            <th style="width: 150px;">PONTUAÃ‡ÃƒO</th>
                            <th style="width: 120px;">VARIAÃ‡ÃƒO</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-body">
                        <!-- Table rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <footer>
            <p>Ranking atualizado todo domingo as 18hrs | LocalPointsÂ© 2023</p>
            <div class="firebase-status disconnected" id="firebase-status">
                <div class="status-dot"></div>
                <span>Desconectado do Firebase</span>
            </div>
        </footer>
    </div>

    <script>
        // Firebase configuration (replace with your own config)
        const firebaseConfig = {
            apiKey: "AIzaSyDHmDR9oQRnLubWSAX-92M-sz70b9AHagE",
            authDomain: "localpoints-gelaclash.firebaseapp.com",
            databaseURL: "https://localpoints-gelaclash-default-rtdb.firebaseio.com",
            projectId: "localpoints-gelaclash",
            storageBucket: "localpoints-gelaclash.firebasestorage.app",
            messagingSenderId: "677400270919",
            appId: "1:677400270919:web:c1147c08523f1c65b57962",
            measurementId: "G-C3C2P5FJBV"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // DOM elements
        const rankingBody = document.getElementById('ranking-body');
        const loading = document.getElementById('loading');
        const rankingTable = document.getElementById('ranking-table');
        const podiumContainer = document.getElementById('podium-container');
        const firebaseStatus = document.getElementById('firebase-status');
        const totalPlayersEl = document.getElementById('total-players');
        const topScoreEl = document.getElementById('top-score');
        const avgPointsEl = document.getElementById('avg-points');
        
        // Update connection status
        const connectedRef = firebase.database().ref(".info/connected");
        connectedRef.on("value", function(snap) {
            if (snap.val() === true) {
                firebaseStatus.className = "firebase-status connected";
                firebaseStatus.innerHTML = '<div class="status-dot"></div><span>Conectado ao servidor</span>';
            } else {
                firebaseStatus.className = "firebase-status disconnected";
                firebaseStatus.innerHTML = '<div class="status-dot"></div><span>Desconectado do servidor</span>';
            }
        });
        
        // Fetch and display ranking data
        function loadRanking() {
            const usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                const users = snapshot.val();
                
                if (!users) {
                    loading.innerHTML = '<i class="fas fa-exclamation-triangle"></i><br>Nenhum jogador encontrado.';
                    return;
                }
                
                // Convert users object to array and sort by points
                const usersArray = Object.keys(users).map(username => {
                    return {
                        username,
                        points: users[username].points || 0,
                        lastWeekPosition: users[username].lastWeekPosition || null
                    };
                });
                
                // Sort by points (descending)
                usersArray.sort((a, b) => b.points - a.points);
                
                // Update stats
                updateStats(usersArray);
                
                // Create podium for top 3
                createPodium(usersArray.slice(0, 3));
                
                // Generate table rows
                generateRankingTable(usersArray);
                
                // Hide loading and show table
                loading.style.display = 'none';
                rankingTable.style.display = 'table';
            }, (error) => {
                loading.innerHTML = '<i class="fas fa-exclamation-triangle"></i><br>Erro ao carregar dados: ' + error.message;
            });
        }
        
        // Update statistics
        function updateStats(usersArray) {
            const totalPlayers = usersArray.length;
            const topScore = usersArray.length > 0 ? usersArray[0].points : 0;
            const avgPoints = usersArray.length > 0 ? 
                Math.round(usersArray.reduce((sum, user) => sum + user.points, 0) / usersArray.length) : 0;
            
            totalPlayersEl.textContent = totalPlayers;
            topScoreEl.textContent = topScore.toLocaleString();
            avgPointsEl.textContent = avgPoints.toLocaleString();
        }
        
        // Create podium for top 3 players
        function createPodium(topThree) {
            podiumContainer.innerHTML = '';
            
            // Create podium items in order: 2nd, 1st, 3rd
            const positions = [
                { pos: 2, class: 'podium-2', medal: 'ðŸ¥ˆ' },
                { pos: 1, class: 'podium-1', medal: 'ðŸ¥‡' },
                { pos: 3, class: 'podium-3', medal: 'ðŸ¥‰' }
            ];
            
            positions.forEach(position => {
                const user = topThree[position.pos - 1];
                
                if (user) {
                    const podiumItem = document.createElement('div');
                    podiumItem.className = `podium-item ${position.class}`;
                    
                    podiumItem.innerHTML = `
                        <div style="font-size: 2.5rem;">${position.medal}</div>
                        <div class="podium-player">${user.username}</div>
                        <div class="podium-points">${user.points.toLocaleString()} pts</div>
                    `;
                    
                    podiumContainer.appendChild(podiumItem);
                }
            });
        }
        
        // Generate ranking table rows
        function generateRankingTable(usersArray) {
            rankingBody.innerHTML = '';
            
            usersArray.forEach((user, index) => {
                const position = index + 1;
                const row = document.createElement('tr');
                
                // Add position class for top 3
                if (position <= 3) {
                    row.className = `pos-${position}`;
                }
                
                // Determine position trend
                let trendIcon = '=', trendClass = 'trend-neutral';
                if (user.lastWeekPosition) {
                    if (user.lastWeekPosition > position) {
                        trendIcon = 'â†—';
                        trendClass = 'trend-up';
                    } else if (user.lastWeekPosition < position) {
                        trendIcon = 'â†˜';
                        trendClass = 'trend-down';
                    }
                }
                
                // Add crown for first place
                const crown = position === 1 ? '<span class="crown">ðŸ‘‘</span>' : '';
                
                // Create avatar initial
                const avatarInitial = user.username.charAt(0).toUpperCase();
                
                row.innerHTML = `
                    <td class="position">
                        ${position <= 3 ? getMedalEmoji(position) : position}
                    </td>
                    <td>
                        <div class="player-info">
                            <div class="player-avatar">${avatarInitial}</div>
                            <div class="player-name">
                                ${user.username} ${crown}
                            </div>
                        </div>
                    </td>
                    <td class="points">${user.points.toLocaleString()}</td>
                    <td class="${trendClass}">${trendIcon}</td>
                `;
                
                rankingBody.appendChild(row);
            });
        }
        
        // Get medal emoji for top 3 positions
        function getMedalEmoji(position) {
            switch(position) {
                case 1: return 'ðŸ¥‡';
                case 2: return 'ðŸ¥ˆ';
                case 3: return 'ðŸ¥‰';
                default: return position;
            }
        }
        
        // Load ranking when page loads
        document.addEventListener('DOMContentLoaded', loadRanking);
        
        // Simulate real-time updates (for demo purposes)
        // In a real app, this would be handled by Firebase directly
        setInterval(() => {
            // This simulates points changing in real-time
            // In a real app, this would come from Firebase updates
            const pointsCells = document.querySelectorAll('.points');
            pointsCells.forEach(cell => {
                // Only occasionally update to simulate real-time changes
                if (Math.random() > 0.7) {
                    const currentPoints = parseInt(cell.textContent.replace(/,/g, ''));
                    const change = Math.floor(Math.random() * 50) - 10;
                    const newPoints = Math.max(0, currentPoints + change);
                    cell.textContent = newPoints.toLocaleString();
                    
                    // Update the top score if needed
                    const currentTopScore = parseInt(topScoreEl.textContent.replace(/,/g, ''));
                    if (newPoints > currentTopScore) {
                        topScoreEl.textContent = newPoints.toLocaleString();
                    }
                }
            });
        }, 5000);
    </script>
</body>
</html> 